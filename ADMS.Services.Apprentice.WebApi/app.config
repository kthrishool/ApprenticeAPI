<?xml version="1.0"?>
<configuration>
  <configSections>
    <section name="entityFramework" type="System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" requirePermission="false"/>
    <section name="employment.typeMapper" type="ADMS.Services.Infrastructure.Core.Configuration.TypeMapperSection, ADMS.Services.Infrastructure.Core"/>
    <section name="employment.authorizationConfiguration" type="ADMS.Infrastructure.Security.Config.AuthorizationConfigurationSection, ADMS.Infrastructure.Security"/>
    <section name="employment.webApiClient" type="ADMS.Services.Infrastructure.WebApiClient.Configuration.WebApiClientSection, ADMS.Services.Infrastructure.WebApiClient"/>
    <section name="employment.swagger" type="ADMS.Services.Infrastructure.WebApi.Documentation.Configuration.SwaggerSection, ADMS.Services.Infrastructure.WebApi"/>
    <section name="employment.webApi" type="ADMS.Services.Infrastructure.WebApi.Configuration.WebApiSection, ADMS.Services.Infrastructure.WebApi"/>
    <section name="employment.serviceRequestMessages" type="ADMS.Services.Infrastructure.Service.Configuration.ServiceRequestMessagesSection, ADMS.Services.Infrastructure.Service"/>
    <section name="employment.requestResponseLog" type="ADMS.Services.Infrastructure.WebApi.Configuration.RequestResponseLogSection, ADMS.Services.Infrastructure.WebApi"/>
    <sectionGroup name="serviceLogging">
      <section name="serviceLog" requirePermission="false" type="ADMS.Services.Infrastructure.Logging.LoggingSectionHandler, ADMS.Services.Infrastructure.Logging"/>
    </sectionGroup>
  </configSections>
  <employment.requestResponseLog enabled="true" logAlways="true" logStatusCode="true" logMethod="true" logElapsedTime="true" logRequestUri="true" logRequestOnError="true" logResponseOnError="true"/>
  <employment.swagger tryItOutEnabled="false"/>
  <serviceLogging>
    <serviceLog level="error" type="ADMS.Services.Infrastructure.Logging.ApiSqlServiceLog, ADMS.Services.Infrastructure.Logging" connectionStringName="EALogging" applicationName="Adms"/>
  </serviceLogging>
  <entityFramework>
    <defaultConnectionFactory type="System.Data.Entity.Infrastructure.LocalDbConnectionFactory, EntityFramework">
      <parameters>
        <parameter value="v11.0"/>
      </parameters>
    </defaultConnectionFactory>
    <providers>
      <provider invariantName="System.Data.SqlClient" type="System.Data.Entity.SqlServer.SqlProviderServices, EntityFramework.SqlServer"/>
    </providers>
  </entityFramework>
  <appSettings>
      <add key="IgnoreVersionHeader" value="true" />
	  <add key="aspnet:UseTaskFriendlySynchronizationContext" value="true"/>
    <!-- Active Directory settings-->
    <add key="SupportedContracts" value="EPS5,WDC5,DESA,DESB,NEI5,HLS5,NPA,JAP,CWCA"/>
    <add key="Environment" value="WKS"/>
    <add key="EssUserCacheDurationMinutes" value="15"/>
    <!-- minutes to keep the ess business objects for a user cached -->
    <add key="DirectoryOnlyProfiling" value="false"/>
    <!-- true = directory based only; false = mixed mode -->
    <add key="UserCaching" value="true"/>
    <!-- true = cache user objects; false = do not cahace user objects -->
	<add key="USIOAuth2ClientID" value="b8bd2f19-5e46-4610-ab6b-744e55c9f46c"/>
  </appSettings>
  <connectionStrings>
    <add name="Db_ConnADW" connectionString="Data Source=ESGSQLD;Initial Catalog=ADW;Integrated Security=SSPI" providerName="System.Data.SqlClient"/>
    <add name="EALogging" connectionString="Data Source=ESGSQLDS;Initial Catalog=EALogging;Integrated Security=SSPI" providerName="System.Data.SqlClient"/>
    <!-- Active Directory -->
    <add name="Db_ESam" connectionString="Data Source=ESGSQLDS;Initial Catalog=ESam;Integrated Security=SSPI" providerName="System.Data.SqlClient"/>
    <add name="EmpDbContext" connectionString="Data Source=DRDMTPSQLD.datasources.network;Initial Catalog=EMP;Integrated Security=SSPI;MultipleActiveResultSets=True;" providerName="System.Data.SqlClient"/>
    <add name="Igas" connectionString="Data Source=DRDSQLES46.datasources.devnetwork;Initial Catalog=iGasSearch;Integrated Security=SSPI" providerName="System.Data.SqlClient"/>
    <add name="IgasSpatial" connectionString="Data Source=DRDSQLES46.datasources.devnetwork;Initial Catalog=iGasSpatial;Integrated Security=SSPI" providerName="System.Data.SqlClient"/>
    <add name="InfrastructureStore" connectionString="Data Source=ESGSQLD;Initial Catalog=InfrastructureStore;Integrated Security=True;enlist=false" providerName="System.Data.SqlClient"/>
    <add name="RequestResponse" connectionString="Data Source=ESGSQLDS;Initial Catalog=EALogging;Integrated Security=SSPI;Enlist=false" providerName="System.Data.SqlClient"/>
    <add name="RequestResponseRingBuffer" connectionString="Data Source=ESGSQLDS;Initial Catalog=EALoggingMO;Integrated Security=SSPI;Enlist=false" providerName="System.Data.SqlClient"/>
    <!-- for local fake service testing -->
    <!--<add name="APIMDataOnPrem" connectionString="Server=DRDMTPSQLD.datasources.network;initial catalog=APIMData;integrated security=True;MultipleActiveResultSets=True;" providerName="System.Data.SqlClient" />-->
  </connectionStrings>
  <employment.typeMapper>
    <types>
      <add name="Authoriser" type="ADMS.Infrastructure.Security.Authorisation.IAuthoriser, ADMS.Infrastructure.Security" mapTo="ADMS.Infrastructure.Security.Authorisation.PrincipalActivityAuthoriser, ADMS.Infrastructure.Security"/>
      <add name="ServiceRequestRepository" type="ADMS.Services.Infrastructure.Service.Interface.IServiceRequestMessageRepository`2, ADMS.Services.Infrastructure.Service" mapTo="ADMS.Services.Infrastructure.Service.Repository.ServiceRequestMessageRepository`2, ADMS.Services.Infrastructure.Service"/>
      <add name="ApprenticeService" type="ADMS.Services.Apprentice.ServiceInterface.IApprenticeService, ADMS.Services.Apprentice" mapTo="ADMS.Services.Apprentice.Service.ApprenticeService, ADMS.Services.Apprentice"/>
      <add name="ApprenticeRepository" type="ADMS.Services.Apprentice.Repository.IApprenticeRepository, ADMS.Services.Apprentice" mapTo="ADMS.Services.Apprentice.Repository.ApprenticeRepository, ADMS.Services.Apprentice"/>
      <add name="ADMSWebApiClient" type="ADMS.Services.Infrastructure.Core.Interface.IADMSWebApiClient, ADMS.Services.Infrastructure.Core" mapTo="ADMS.Services.Infrastructure.WebApiClient.ApiClient.ADMSWebApiClient, ADMS.Services.Infrastructure.WebApiClient"/>
      <add name="Logger" type="ADMS.Services.Infrastructure.Core.Interface.ILogger, ADMS.Services.Infrastructure.Core" mapTo="ADMS.Services.Infrastructure.Logging.XLogger, ADMS.Services.Infrastructure.Logging"/>
      <add name="User" type="ADMS.Services.Infrastructure.Core.Interface.IUser, ADMS.Services.Infrastructure.Core" mapTo="ADMS.Services.Infrastructure.Core.Identity.User, ADMS.Services.Infrastructure.Core"/>
      <add name="FeatureToggle" type="ADMS.Infrastructure.Feature.IFeatureToggle,  ADMS.Infrastructure.Feature" mapTo="ADMS.Infrastructure.Feature.FeatureToggleInternal, ADMS.Infrastructure.Feature"/>
    </types>
  </employment.typeMapper>
  <employment.authorizationConfiguration>
    <apiAuthorization authorizationOnly="true"/>
  </employment.authorizationConfiguration>
  <employment.webApiClient allowSpecifiedDateTime="true" throwAggregateException="true" usePerRequestCache="false" usePerRequestCacheIfFeatureEnabled="false" useConnectionTimeout="false" useConnectionTimeoutIfFeatureEnabled="false" useConnectionClose="false" useConnectionCloseIfFeatureEnabled="false" denySpecifiedDateTimeForSystemToSystem="false" denySpecifiedDateTimeForSystemToSystemIfFeatureEnabled="false">
    <WebApiSecurity jwtEnabled="true"/>
    <WebApiResources>
      <WebApiResource name="Configuration" uri="" functionalArea="Authorisation">
        <Methods>
          <Method name="Get" uri="/CurrentConfiguration" />
        </Methods>
      </WebApiResource>
    </WebApiResources>
    <FunctionalAreas>
      <FunctionalArea name="Authorisation" host="Dev" url="/Authorisation/api"/>
      <FunctionalArea name="Default" host="Dev" url="/Default/api"/>
    </FunctionalAreas>
    <Hosts>
      <!-- these are handled by the shared config file after localdev -->
      <Host name="localDevRefData" url="http://localhost:17249"/>
      <Host name="Dev" url="http://webapi.edc.hosts.devnetwork/dev"/>
      <Host name="DevX" url="http://webapi.edc.hosts.devnetwork/devx"/>
      <Host name="Test" url="http://webapi.edc.hosts.testnetwork/test"/>
      <Host name="Test1" url="http://webapi.edc.hosts.testnetwork/test1"/>
      <Host name="Test2" url="http://webapi.edc.hosts.testnetwork/test2"/>
      <Host name="Test3" url="http://webapi.edc.hosts.testnetwork/test3"/>
      <Host name="Test4" url="http://webapi.edc.hosts.testnetwork/test4"/>
      <Host name="TestFix" url="http://webapi.edc.hosts.testfixnetwork/TESTFIX"/>
      <Host name="ETestFix" url="http://webapi.testfix.edc.hosts.network/etestfix"/>
      <Host name="PProd" url="http://webapi.pprod.edc.hosts.network"/>
      <Host name="Prod" url="http://webapi.hosts.network"/>
      <Host name="PTrn" url="http://trainingwebapi.pprod.edc.hosts.network"/>
      <Host name="Trn" url="http://trainingwebapi.hosts.network"/>
      <Host name="Lt" url="http://loadtestwebapi.hosts.application.enet"/>
    </Hosts>
  </employment.webApiClient>
  <employment.webApi>
    <unauthorizedException returnDetailedInformation="true"/>
    <internalServerError returnDetailedInformation="true"/>
    <userContext allowSpecifiedDateTime="true" denySpecifiedDateTimeForSystemToSystem="false" denySpecifiedDateTimeForSystemToSystemIfFeatureEnabled="false"/>
    <corsContext allowCors="false"/>
    <jwtSecurity enabled="true" useDefaultAudiences="true" defaultAudienceSuffix=":dev" federationMetadata="https://sts.dev.construction.enet/federationmetadata/2007-06/federationmetadata.xml">
      <audiences>
        <add audience="urn:api:Adms:dev"/>
        <add audience="urn:mvc:essweb:dev"/>
        <add audience="urn:localdev"/>
        <!-- Other direct callers -->
        <add audience="urn:api:administration:dev"/>
        <add audience="urn:api:authorisation:dev"/>
        <add audience="urn:api:casemanagement:dev"/>
        <add audience="urn:api:claim:dev"/>
        <add audience="urn:api:documentstore:dev"/>
        <add audience="urn:api:documenttransactions:dev"/>
        <add audience="urn:api:employer:dev"/>
        <add audience="urn:api:fund:dev"/>
        <add audience="urn:mvc:pat:dev"/>
        <add audience="urn:mvc:esswebinternal:dev"/>
        <add audience="http://jobsearch.dev.idc.hosts.network/"/>
        <add audience="http://jobseekermobile.dev.idc.hosts.network/dev/rest/"/>
        <add audience="urn:mcia:mcia:dev"/>
      </audiences>
      <delegatedIssuers>
        <add issuer="urn:iss:localdev" thumbprint="DB85F98B3837287FD98179C92CB8A40FA32A34FF"/>
      </delegatedIssuers>
    </jwtSecurity>
  </employment.webApi>
  <employment.serviceRequestMessages connectionStringName="Db_ConnADW"/>
</configuration>